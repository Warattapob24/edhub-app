<div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
        <thead class="table-light">
            <tr>
                <th>รหัสนักเรียน</th>
                <th>ชื่อ-นามสกุล</th>
                <th>สถานะ</th>
                <th>ห้องเรียนปัจจุบัน</th>
                <th class="text-end">การกระทำ</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
            {% set non_active_statuses = ['ลาออก', 'ย้ายออก', 'พ้นสภาพ', 'แขวนลอย', 'พักการเรียน'] %}
            {# [แก้ไข] เปลี่ยนจาก table-secondary text-muted เป็น table-danger #}
            <tr class="{% if student.status in non_active_statuses %}table-danger{% endif %}">
                <td>{{ student.student_id }}</td>
                <td>{{ student.name_prefix }}{{ student.first_name }} {{ student.last_name }}</td>
                <td>
                    {% set status_color = 'bg-success' %}
                    {% if student.status in ['ลาออก', 'ย้ายออก', 'พ้นสภาพ'] %}
                        {% set status_color = 'bg-danger' %}
                    {% elif student.status in ['พักการเรียน', 'แขวนลอย'] %}
                        {% set status_color = 'bg-warning text-dark' %}
                    {% endif %}
                    <span class="badge {{ status_color }}">{{ student.status }}</span>
                </td>
                <td>
                    {% if current_year %}
                        {% for enrollment in student.enrollments %}
                            {% if enrollment.classroom.academic_year_id == current_year.id %}
                                <span class="badge bg-info">{{ enrollment.classroom.name }}</span>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td class="text-end">
                    <a href="{{ url_for('admin.view_student_profile', student_id=student.id) }}" class="btn btn-sm btn-outline-primary">ดูรายละเอียด</a>
                    <button class="btn btn-sm btn-outline-secondary manage-status-btn"
                            data-bs-toggle="modal"
                            data-bs-target="#studentStatusModal"
                            data-student-id="{{ student.id }}">
                        <i class="bi bi-person-lines-fill"></i> จัดการสถานะ
                    </button>
                    <a href="{{ url_for('admin.edit_student', student_db_id=student.id) }}" class="btn btn-sm btn-outline-warning"><i class="bi bi-pencil-fill"></i> แก้ไข</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="text-center">ไม่พบข้อมูลนักเรียนตามเงื่อนไขที่กำหนด</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="mt-3">
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">

            {# ปุ่ม "ก่อนหน้า" #}
            <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                {% set prev_params = request.args.to_dict() %}
                {% do prev_params.update({'page': pagination.prev_num}) %}
                <a class="page-link" href="{{ url_for('admin.list_students', **prev_params) }}">ก่อนหน้า</a>
            </li>

            {# ปุ่มตัวเลขแต่ละหน้า #}
            {% for page_num in pagination.iter_pages() %}
                {% if page_num %}
                    <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
                        {% set page_params = request.args.to_dict() %}
                        {% do page_params.update({'page': page_num}) %}
                        <a class="page-link" href="{{ url_for('admin.list_students', **page_params) }}">{{ page_num }}</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                {% endif %}
            {% endfor %}

            {# ปุ่ม "ถัดไป" #}
            <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                {% set next_params = request.args.to_dict() %}
                {% do next_params.update({'page': pagination.next_num}) %}
                <a class="page-link" href="{{ url_for('admin.list_students', **next_params) }}">ถัดไป</a>
            </li>

        </ul>
    </nav>
</div>