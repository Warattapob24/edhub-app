---

# **คำสั่ง:**

จงสร้างเว็บแอปพลิเคชัน Full-Stack แนวทาง **School Intelligence Platform** ชื่อแอป >> **EdHub** << สำหรับบริหารจัดการผลการเรียน โดยอ้างอิงจากบทเรียน, ข้อผิดพลาด, และการออกแบบที่สำเร็จแล้วจากโปรเจกต์ก่อนหน้า เพื่อสร้างระบบที่มีเสถียรภาพ, ยืดหยุ่น, และใช้งานง่ายที่สุด

---

## **📊 Project Blueprint: EdHub (ฉบับสมบูรณ์)**

เอกสารนี้คือแผนแม่บทสำหรับพัฒนาเว็บแอปพลิเคชัน **EdHub** ซึ่งเป็น **School Intelligence Platform** ที่มุ่งเน้นการลดภาระงานของครูและสร้างระบบบริหารจัดการผลการเรียนที่ชาญฉลาดและยืดหยุ่น

### **⭐ 1. ปรัชญาและหัวใจหลักของระบบ (Core Philosophy & Strengths)**

เราจะรักษาจุดแข็งที่พิสูจน์แล้วว่าประสบความสำเร็จ พร้อมยึดมั่นในปรัชญาการออกแบบที่ชัดเจน

* **ปรัชญาหลัก:** สร้างเครื่องมือที่ **"ลดภาระครู ไม่ใช่เพิ่มภาระ"** โดยเน้นการ **"ประเมินภาพรวมได้ทันที แต่เจาะลึกได้อย่างอิสระ"**
* **ระบบกรอกคะแนนที่ยืดหยุ่น (Dual-Entry Scoring):** รองรับทั้งการกรอก **"คะแนนรวม"** และการลงคะแนนย่อยผ่าน **"Pop-up KPA"**
* **การประเมินเพิ่มเติมที่ละเอียด (Hierarchical Assessments):** รองรับการประเมิน 2 ระดับ (หัวข้อหลักและตัวชี้วัดย่อย)
* **เครื่องมือช่วยกรอกอัจฉริยะ (Smart Entry Tools):** ฟังก์ชัน **"Set All"** เพื่อลดงานซ้ำซ้อน
* **ระบบบทบาทที่ยืดหยุ่น (Many-to-Many Roles):** ผู้ใช้หนึ่งคนมีได้หลายบทบาท เมนูจะแสดงตามสิทธิ์ทั้งหมดที่มี
* **แดชบอร์ดสรุปผล (Decision Support Dashboard):** รวมข้อมูล สถิติ และเสนอแนะผลการประเมินเพื่อช่วยครูที่ปรึกษา

---

### **🛠️ 2. กฎเกณฑ์และการตัดสินใจทางเทคนิค (Technical Decisions & Rules)**

ข้อตกลงและสถาปัตยกรรมที่ใช้เป็นมาตรฐานในการพัฒนา

* **Admin Panel:** **สร้าง Custom Admin Panel เองทั้งหมด** โดยเลิกใช้ `Flask-Admin` เพื่อความเสถียรและการควบคุมที่สมบูรณ์ 100%
* **UI Framework:** ใช้ **Bootstrap 5** เป็นมาตรฐานหลักทั่วทั้งโปรเจกต์
* **Pop-up / Modal:** **ใช้ Bootstrap Modal เป็นมาตรฐานหลัก** สำหรับการแสดงหน้าต่าง Pop-up เพื่อความสอดคล้องของ UI และการจัดการที่ง่าย
* **Database Migration:** **ต้องรักษา Migration History ไว้เสมอ** นับจากนี้เป็นต้นไป จะไม่ใช้วิธี "Final Reset" (ลบ DB และ `migrations` folder) อีกต่อไป เพื่อให้สามารถย้อนกลับหรือปรับปรุงโครงสร้างฐานข้อมูลในอนาคตได้อย่างปลอดภัย
* **Centralized Logic:** รวมฟังก์ชันที่ใช้ซ้ำๆ เช่น `calculate_grade` ไว้ที่ `app/utils.py` เพื่อให้แก้ไขและดูแลรักษาง่าย
* **Naming Consistency:** กำหนดมาตรฐานการตั้งชื่อตัวแปรและโมเดลให้สอดคล้องกัน และตรวจสอบทุกไฟล์ที่อ้างอิงเมื่อมีการเปลี่ยนแปลง
* **Workflow การทำงาน:**
    1.  **เสนอ UX/UI ก่อนเริ่มภารกิจเสมอ**
    2.  รวบรวมการแก้ไขโค้ดทุกไฟล์ที่เกี่ยวข้องไว้ใน Prompt เดียว
    3.  **สรุปผลและอัปเดต Blueprint หลังจบภารกิจทุกครั้ง**



---

### **🚀 3. แผนการทำงาน (Project Roadmap)**

แผนการพัฒนาจะแบ่งออกเป็นเฟสต่างๆ โดยอิงตาม Workflow ของผู้ใช้งานเป็นหลัก

* [✅] **Phase 1: วางรากฐานและระบบ Admin (Completed)**
    * พัฒนาระบบ CRUD, Import/Export, Seeding ข้อมูลพื้นฐานทั้งหมด (ผู้ใช้, บทบาท, รายวิชา, นักเรียน, ฯลฯ)
    * สร้างระบบมอบหมายภาระการสอน (Course Assignment) และสถาปัตยกรรม "แผนการสอนหลัก" (Master Plan)
    * สร้างเครื่องมือสร้างแม่แบบการประเมิน (Assessment Template Builder)
    * อัปเกรด UI/UX ทั้งหมดเป็น Bootstrap 5

* [▶️] **Phase 2: สร้าง Workflow หลักของครูผู้สอน (In Progress)**
    * [✅] 2.1: สร้าง Teacher Dashboard และระบบบังคับตั้งค่าบัญชีครั้งแรก
    * [✅] 2.2: สร้างโครงสร้างหน้า "Course Workspace" สำหรับจัดการรายวิชา
    * [✅] 2.3: พัฒนา **แท็บที่ 1: แผนการจัดการเรียนรู้** (บันทึกข้อมูลพื้นฐานได้)
    * [▶️] **2.4: พัฒนา แท็บที่ 2: ตั้งค่าผังการประเมิน (Assessment Blueprint)** <== **ภารกิจปัจจุบัน**
        * *สถานะ: อยู่ระหว่างการพัฒนา UI และ Logic การจัดการรายการคะแนนเก็บ*
    * [ ] 2.5: พัฒนา **แท็บที่ 3: ตารางบันทึกผล (Gradebook)**
    * [ ] 2.6: พัฒนา **แท็บที่ 4: บันทึกหลังสอน**
    * [ ] 2.7: พัฒนาระบบเช็คชื่อ/บันทึกเวลาเรียน
    * [ ] **2.8: (เป้าหมายสำคัญ) รวม Layout หลักของแอปพลิเคชันให้เป็นไฟล์กลางไฟล์เดียว** เพื่อให้ทุกส่วน (Admin, Teacher) มีโครงสร้างหน้าเว็บที่เหมือนกัน

* [ ] **Phase 3: ระบบอนุมัติและรายงานผล (Planned)**
    * Export เอกสาร ปถ.05 และรายงานอื่นๆ ในรูปแบบ PDF/Word

* [ ] **Phase 4: บทบาทอื่นๆ (Planned)**
    * พัฒนา Dashboard และ Workflow สำหรับครูที่ปรึกษา, หัวหน้ากลุ่มสาระ, ผู้บริหาร, และนักเรียน

* [ ] **Phase 5: ฟีเจอร์สิ้นปีการศึกษา (Planned)**
    * ระบบการสอนซ่อมเสริมและการเลื่อนชั้น

* [🅿️] **Phase 6: ระบบจัดตารางสอนอัจฉริยะ (Placeholder)**
    * *สถานะ: เป็นเป้าหมายในอนาคต เตรียมไว้สำหรับต่อยอดระบบ*

---

### **📌 4. สถานะปัจจุบันและภารกิจถัดไป (Current Status & Next Steps)**

* **ความสำเร็จล่าสุด:**
    * โครงสร้างหน้า **"Course Workspace"** สำหรับครูผู้สอนเสร็จสมบูรณ์
    * ระบบจัดการ "หน่วยการเรียนรู้" (Learning Units) ใช้งานได้
    * **แท็บที่ 1 (แผนการจัดการเรียนรู้)** สามารถบันทึกข้อมูลเบื้องต้นได้แล้ว

* **ภารกิจปัจจุบัน:**
    * กำลังพัฒนา **แท็บที่ 2 "ตั้งค่าผังการประเมิน"**
    * **ปัญหาที่ต้องแก้ไข:** Bug ในหน้าต่าง Bootstrap Modal สำหรับเลือกหัวข้อการประเมิน ที่การแสดงผลหัวข้อย่อยและการเลือกแบบสัมพันธ์กัน (แม่-ลูก) ยังทำงานไม่ถูกต้อง

* **เป้าหมายถัดไป:**
    1.  แก้ไข Bug ใน Modal ของแท็บที่ 2 ให้เสร็จสมบูรณ์
    2.  พัฒนาส่วน UI ของแท็บที่ 2 ให้ครบถ้วน (รายการคะแนนเก็บ, การสอบ, แผงสรุปคะแนน)
    3.  เริ่มต้นการพัฒนา **แท็บที่ 3 "ตารางบันทึกผล" (Gradebook)**

## 📊 Project Blueprint: EdHub (อัปเดต ณ วันที่ 11 กันยายน 2568)
ปรัชญาหลัก: สร้างเครื่องมือที่ "ลดภาระครู ไม่ใช่เพิ่มภาระ" โดยเน้นการ "ประเมินภาพรวมได้ทันที แต่เจาะลึกได้อย่างอิสระ"

แผนการทำงาน (Project Roadmap)
[✅] Phase 1: วางรากฐานและระบบ Admin (Completed)

[▶️] Phase 2: สร้าง Workflow หลักของครูผู้สอน (In Progress)

[✅] 2.1: สร้าง Teacher Dashboard และระบบบังคับตั้งค่าบัญชีครั้งแรก

[✅] 2.2: สร้างโครงสร้างหน้า "Course Workspace" สำหรับจัดการรายวิชา

[✅] 2.3: พัฒนา แท็บที่ 1: แผนการจัดการเรียนรู้ (พร้อมระบบจัดการคาบเรียนสะสม)

[✅] 2.4: พัฒนา แท็บที่ 2: ตั้งค่าผังการประเมิน (พร้อมระบบบันทึกคะแนนสอบและหัวข้อประเมิน)

[▶️] 2.5: พัฒนา แท็บที่ 3: ตารางบันทึกผล (Gradebook) <== ภารกิจปัจจุบัน

[ ] 2.6: พัฒนา แท็บที่ 4: บันทึกหลังสอน

[ ] 2.7: พัฒนาระบบเช็คชื่อ/บันทึกเวลาเรียน

[ ] 2.8: (เป้าหมายสำคัญ) รวม Layout หลักของแอปพลิเคชันให้เป็นไฟล์กลาง

สถานะปัจจุบันและภารกิจถัดไป
ความสำเร็จล่าสุด:

แท็บที่ 1 "แผนการจัดการเรียนรู้" และ แท็บที่ 2 "ตั้งค่าผังการประเมิน" ทำงานได้อย่างสมบูรณ์และเชื่อมโยงกัน

ระบบ Tom-Select สำหรับจัดการตัวชี้วัดทำงานได้อย่างเสถียร

ระบบ จัดการชั่วโมงสอนอัตโนมัติ สามารถคำนวณและแสดงผลคาบเรียนสะสมได้

เป้าหมายถัดไป:

เริ่มต้นการออกแบบและพัฒนา แท็บที่ 3 "ตารางบันทึกผล" (Gradebook)

## ⚙️ สรุปฟังก์ชันการทำงานหลัก (Key Functionalities Summary)
นี่คือสรุปการทำงานของฟังก์ชันที่ซับซ้อนที่เราได้พัฒนากันมาในหน้า Workspace ครับ:

สถาปัตยกรรมแบบ Single Page Application (SPA-like)

การคลิกเมนูหรือแท็บต่างๆ จะเป็นการโหลดเนื้อหาใหม่ผ่าน JavaScript (Fetch) โดยไม่มีการรีโหลดหน้าเว็บใหม่ทั้งหมด ทำให้การใช้งานรวดเร็วและราบรื่น พร้อม Fade Animation เพื่อความสวยงาม

การซิงค์ UI สองทาง (Two-Way UI Sync) ↔️

เมนูด้านซ้าย (Unit List) และ Accordion ในแท็บ "ตั้งค่าการประเมิน" จะทำงานสัมพันธ์กันเสมอ ไม่ว่าจะคลิกเลือกจากฝั่งไหน อีกฝั่งหนึ่งจะอัปเดตตามโดยอัตโนมัติ

ระบบจัดการคาบเรียนอัตโนมัติ (Automated Period Management) 🕒

ระบบจะคำนวณ "ชั่วโมงสอนที่จัดสรรได้" จากหน่วยกิตของรายวิชา และหักลบคาบสอบ (กลางภาค/ปลายภาค) ให้อัตโนมัติตามหน่วยกิต ครูเพียงแค่กรอกจำนวนคาบที่ต้องการใช้ในแต่ละหน่วย ระบบจะคำนวณคาบเรียนสะสมให้ทันที

การจัดการข้อมูลแบบรวมศูนย์ (Centralized Logic)

โค้ด JavaScript ที่ซับซ้อนทั้งหมดถูกรวมไว้ที่ไฟล์ course_workspace.html เพียงที่เดียว และใช้เทคนิค Event Delegation ในการจัดการ Event ทำให้โค้ดเป็นระเบียบ แก้ไขง่าย และป้องกัน Bug การทำงานซ้ำซ้อน

